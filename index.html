<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Yamanami Dorm</title>
    <style>
        @font-face {
            font-family: 'Persona5main';
            src: url('Persona5main.ttf') format('truetype'); /* Ensure the font file is correctly linked */
        }

        body {
            text-align: center;
            /* Centers the content horizontally */
            font-family: 'Persona5main', sans-serif;
            background-image: url('img/background.png'); /* Adjust the path to where your image is located */
            background-position: top left; /* Aligns the image to the right top corner */
            background-repeat: no-repeat;
            background-size: cover; /* Ajusta la imagen para cubrir todo el espacio disponible */
            background-attachment: scroll; /* Opcional: mantiene la imagen fija durante el desplazamiento */
            color: #fff;
            padding-top: 20px;
            display: flex;
            flex-direction: column;
            align-items: center; /* Centers the content horizontally */
        }
        h1, h2 {
            font-size: 72px; /* Large font size for main header */
            letter-spacing: 0.5px; /* Slight space increase between letters */
            word-spacing: 20px; /* Increase space between words */
            transform: rotate(-2deg); /* Slight overall rotation for style */
            margin-top: 0; /* Remove any default margin */
            padding-top: 20px; /* Padding from the top of the page */
        }

        h2 {
            font-size: 48px; /* Smaller font size for subheaders */
            color: #ffeedd; /* Light color for subheaders */
            margin-top: 50px; /* Space above subheader */
            word-spacing: 0; /* Normal word spacing for subheaders */
        }

        .container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            padding: 20px;
        }
        .character-card {
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.5)); /* Faded white gradient background */
            border: 1px solid #ccc;
            border-radius: 8px;
            margin: 10px;
            padding: 10px;
            width: 300px; /* Fixed card width */
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            display: block; /* Makes the card a block element for link functionality */
            text-decoration: none; /* Removes underline from links */
            color: black; /* Ensures text is black, not default anchor tag color */
        }

            .character-card img {
                width: 300px; /* Fixed width for images */
                height: 300px; /* Fixed height for images */
                border-radius: 5px;
                object-fit: cover; /* Ensures images cover the fixed dimensions without distortion */
            }

            .character-card:hover {
                background-color: #f4f4f4; /* Changes background on hover */
                cursor: pointer;
            }
        /* Sidebar styles */
        .sidebar {
            height: 100%; /* Full-height: remove this if you want "auto" height */
            width: 0; /* Set the width of the sidebar */
            position: fixed; /* Fixed Sidebar (stay in place on scroll) */
            z-index: 1; /* Stay on top */
            top: 0; /* Stay at the top */
            left: 0;
            background-color: #111; /* Black */
            overflow-x: hidden; /* Disable horizontal scroll */
            padding-top: 100px; /* Place content 60px from the top */
            transition: 0.5s; /* 0.5 second transition effect to slide in the sidebar */
        }

            /* The sidebar links */
            .sidebar a {
                padding: 10px 15px;
                text-decoration: none;
                font-size: 25px;
                color: #818181;
                display: block;
                transition: 0.3s;
            }

                /* When you mouse over the navigation links, change their color */
                .sidebar a:hover {
                    color: #f1f1f1;
                }
        .openbtn {
            font-size: 20px;
            cursor: pointer;
            background-color: #555;
            color: white;
            border: none;
            position: fixed; /* Asegura que el botón se mantenga en una posición fija en la pantalla */
            top: 10px; /* 10px desde la parte superior */
            left: 10px; /* 10px desde la izquierda, ajusta según necesites */
            width: 60px;
            height: 60px;
        }

        table {
            width: 80%; /* Adjust table width as needed */
            max-width: 960px; /* Maximum width of the table */
            margin: 0 auto; /* Centering the table horizontally */
            border-collapse: collapse; /* This allows for border spacing */
            background-color: #ffffff;
            color: #333;
        }

        th, td {
            border: 1px solid #ccc;
            padding: 5px; /* Increase padding inside cells */
            text-align: center;
        }

        th {
            background-color: #666;
            color: white;
        }


        .time-slot {
            background-color: #9b9b9b;
            height: 100px;
        }

        .editable {
            cursor: pointer;
        }

        #weekNavigation {
            margin: 20px;
            text-align: center;
        }

        .nav-button {
            cursor: pointer;
            padding: 10px;
            font-size: 16px;
            color: #fff;
            background-color: #666;
            border: none;
        }
    </style>
</head>
<body>
    <div id="mySidebar" class="sidebar">
        <a href="#">Agenda</a>
        <a href="#">Characters</a>
        <a href="#">Store</a>
        <a href="#">Abilites</a>
    </div>
    <button class="openbtn" onclick="openNav()">☰</button>
    <h1 id="randomColorText">Welcome to Yamanami Dorm</h1>

    <h1>Agenda</h1>
    <div id="weekNavigation">
        <button class="nav-button" onclick="changeWeek(-1)">&#10094; Prev Week</button>
        <span id="weekLabel"></span>
        <button class="nav-button" onclick="changeWeek(1)">Next Week &#10095;</button>
    </div>
    <table id="agendaTable">
        <thead>
            <tr>
                <th>Time/Date</th>
            </tr>
        </thead>
        <tbody>
            <!-- Time slots will be generated by JavaScript -->
        </tbody>
    </table>
    <h2>Main Characters</h2>

    <div class="container">
        <!-- Main character cards -->
        <a href="url/to/character-details1" class="character-card">
            <img src="img/MakiNilha.png" alt="Maki Nilha">
            <h3>Maki Nilha</h3>
            testWrite();
        </a>
        <a href="url/to/character-details1" class="character-card">
            <img src="img/Alfons.png" alt="Alfons Gewaltig">
            <h3>Alfons Gewaltig</h3>
        </a>
        <a href="url/to/character-details1" class="character-card">
            <img src="img/Yoru.png" alt="Yoru Kuroikami">
            <h3>Yoru Kuroikami</h3>
        </a>
        <a href="url/to/character-details1" class="character-card">
            <img src="img/Vincent.png" alt="Vincent">
            <h3>Vincent</h3>

        </a>
        <!-- Additional main characters -->
    </div>

    <h2>Other Characters</h2>
    <div class="container">
        <!-- Other character cards -->
        <a href="url/to/character-details2" class="character-card">
            <img src="img/kenji.png" alt="-">
            <h3>Kenji Tomochika</h3>
        </a>
        <a href="url/to/character-details2" class="character-card">
            <img src="img/Gwen.png" alt="-">
            <h3>Gwen</h3>
        </a>
        <a href="url/to/character-details2" class="character-card">
            <img src="img/Mitsuru.png" alt="-">
            <h3>Mitsuru kirijo</h3>
        </a>
        <a href="url/to/character-details2" class="character-card">
            <img src="img/Akihiko.jpg" alt="-">
            <h3>Akihiko Sanada</h3>
        </a>
        <a href="url/to/character-details2" class="character-card">
            <img src="img/Sojiro.png" alt="-">
            <h3>Sojiro Sakura</h3>
        </a>
        <a href="url/to/character-details2" class="character-card">
            <img src="img/Rise.png" alt="-">
            <h3>Rise Kujikawa</h3>
        </a>
        <a href="url/to/character-details2" class="character-card">
            <img src="img/Yukari.png" alt="-">
            <h3>Yukari Takeba</h3>
        </a>
        <a href="url/to/character-details2" class="character-card">
            <img src="img/Tae.png" alt="-">
            <h3>Tae Takemi</h3>
        </a>
        <a href="url/to/character-details2" class="character-card">
            <img src="img/Maya.png" alt="-">
            <h3>Maya</h3>
        </a>
        <a href="url/to/character-details2" class="character-card">
            <img src="img/Naoto.png" alt="-">
            <h3>Naoto Shirogane</h3>
        </a>
        <a href="url/to/character-details2" class="character-card">
            <img src="img/Saori.png" alt="-">
            <h3>Saori Hasegawa</h3>
        </a>
        <a href="url/to/character-details2" class="character-card">
            <img src="img/Jhoris.png" alt="-">
            <h3>Jhoris Johan</h3>
        </a>

        <!-- Additional other characters -->
    </div>

    <script>
        const daysOfWeek = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
        const timeSlots = ['Morning', 'Noon', 'Afternoon', 'Evening', 'Night'];

        let storedDate = localStorage.getItem('currentDate');
        let currentDate = storedDate ? new Date(storedDate) : new Date(new Date().getFullYear(), 4, 7); // Asumiendo que 4 es Mayo y 7 es el día

        function generateTableHeader() {
            let headerRow = document.querySelector('thead tr');
            headerRow.innerHTML = '<th>Time/Date</th>'; // Clear existing headers
            let weekStart = new Date(currentDate);
            weekStart.setDate(weekStart.getDate() - weekStart.getDay() + 1); // Adjust to Monday of the current week

            daysOfWeek.forEach((day, index) => {
                let th = document.createElement('th');
                let date = new Date(weekStart);
                date.setDate(date.getDate() + index);
                th.textContent = `${day} ${date.getDate()}/${date.getMonth() + 1}`;
                headerRow.appendChild(th);
            });
        }

        function generateTableBody() {
            let tbody = document.querySelector('tbody');
            tbody.innerHTML = ''; // Limpiar filas existentes
            timeSlots.forEach(slot => {
                let row = document.createElement('tr');
                let th = document.createElement('th');
                th.textContent = slot;
                th.className = 'time-slot';
                row.appendChild(th);

                daysOfWeek.forEach((day, index) => {
                    let td = document.createElement('td');
                    td.className = 'editable';
                    td.setAttribute('contenteditable', 'true');
                    td.setAttribute('data-day', day);
                    td.setAttribute('data-slot', slot);
                    let dateOfCell = new Date(currentDate); // Asume que currentDate es la fecha del lunes de la semana mostrada
                    dateOfCell.setDate(dateOfCell.getDate() + index); // Ajusta la fecha para cada día de la semana
                    td.setAttribute('data-date', dateOfCell.toISOString().substring(0, 10)); // Establece la fecha de la celda
                    let savedData = localStorage.getItem(`${day} ${slot} ${dateOfCell.toISOString().substring(0, 10)}`);
                    if (savedData) {
                        td.textContent = savedData;
                    }
                    row.appendChild(td);
                });

                tbody.appendChild(row);
            });
        }


        function changeWeek(direction) {
            currentDate.setDate(currentDate.getDate() + 7 * direction);
            localStorage.setItem('currentDate', currentDate.toISOString()); // Guarda la fecha actual en localStorage
            updateWeekLabel();
            generateTableHeader();
            generateTableBody();
        }

        function updateWeekLabel() {
            let weekStart = new Date(currentDate);
            weekStart.setDate(weekStart.getDate() - weekStart.getDay() + 1); // Adjust to Monday
            let weekEnd = new Date(weekStart);
            weekEnd.setDate(weekEnd.getDate() + 6); // Sunday
            document.getElementById('weekLabel').innerHTML = '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;';
        }

        

        function openNav() {
            document.getElementById("mySidebar").style.width = "250px";
        }

        function closeNav() {
            document.getElementById("mySidebar").style.width = "0";
        }

        function randomizeColors() {
            const heading = document.getElementById('randomColorText');
            const text = heading.innerText;
            let newHtml = '';
            let colors = ['white', 'black']; // Define color options

            // Wrap each character in a span, assign a random color
            for (let i = 0; i < text.length; i++) {
                const colorIndex = Math.floor(Math.random() * colors.length);
                newHtml += `<span style="color: ${colors[colorIndex]};">${text[i]}</span>`;
            }

            heading.innerHTML = newHtml; // Apply the new HTML to the heading
        }

        function openNav() {
            document.getElementById("mySidebar").style.width = "250px";
        }

        function closeNav() {
            document.getElementById("mySidebar").style.width = "0";
        }
        function openNav() {
            document.getElementById("mySidebar").style.width = "250px";
        }

        function closeNav() {
            document.getElementById("mySidebar").style.width = "0";
        }
        

        document.addEventListener('DOMContentLoaded', function () {
            const sidebar = document.getElementById('mySidebar');
            sidebar.addEventListener('mouseover', openNav);
            sidebar.addEventListener('mouseout', closeNav);
        });

        document.addEventListener('DOMContentLoaded', function () {
            const heading = document.getElementById('randomColorText');
            const text = heading.innerText;
            let newHtml = '';
            let colors = ['white', 'black']; // Define color options

            // Wrap each character in a span, assign a random color
            for (let i = 0; i < text.length; i++) {
                const colorIndex = Math.floor(Math.random() * colors.length);
                newHtml += `<span style="color: ${colors[colorIndex]};">${text[i]}</span>`;
            }

            heading.innerHTML = newHtml; // Apply the new HTML to the heading
        });

    </script>
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
        import { getFirestore, doc, setDoc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore.js";

        import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-analytics.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAyt_9YFvhYF_f5adSS1M_FrJ1bQ199VWY",

            authDomain: "yamanami-dorm.firebaseapp.com",

            projectId: "yamanami-dorm",

            storageBucket: "yamanami-dorm.appspot.com",

            messagingSenderId: "139150495901",

            appId: "1:139150495901:web:7454d8468a90e22a538474",

            measurementId: "G-7M5EGBC3R9"

        };


        // Initialize Firebase

        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const db = getFirestore(app);
        console.log(db);
        console.log(db.collection);

        async function saveAgendaData() {
            const cells = document.querySelectorAll('td.editable');

            for (const cell of cells) {
                const slot = cell.getAttribute('data-slot'); // Ejemplo: 'Morning'
                const dateOfCell = cell.getAttribute('data-date'); // Ejemplo: '2024-05-06'
                const data = cell.textContent.trim(); // Captura el nuevo contenido de la actividad

                const docRef = doc(db, "agenda", dateOfCell); // Referencia al documento por su fecha

                try {
                    const fieldToUpdate = `${slot}.activity`; // Campo específico a actualizar
                    await updateDoc(docRef, { [fieldToUpdate]: data }); // Actualiza solo el campo específico
                    console.log("Activity updated successfully for", dateOfCell, slot);
                } catch (error) {
                    console.error("Error updating activity for", dateOfCell, slot, ":", error);
                }
            }
        }

        async function loadAgendaData() {
            const cells = document.querySelectorAll('td.editable');
            cells.forEach(async (cell) => {
                const day = cell.getAttribute('data-day');
                const slot = cell.getAttribute('data-slot');
                const dateOfCell = cell.getAttribute('data-date');  // Ensure this attribute is set in your HTML when generating cells

                if (!dateOfCell) {
                    console.error("Missing date for cell:", cell);
                    return; // Skip this cell if date is missing
                }

                const docRef = doc(db, "agenda", dateOfCell);
                console.log("Loading data for:", dateOfCell, day, slot); // Debugging output

                try {
                    const docSnap = await getDoc(docRef);
                    if (docSnap.exists()) {
                        console.log("Data found for:", dateOfCell); // Confirm data is found
                        const activityData = docSnap.data()[slot].activity; // Assuming your structure includes slot and activity
                        cell.textContent = activityData || ""; // Populate cell or indicate no activity
                    } else {
                        console.log("No document found for:", dateOfCell);
                    }
                } catch (error) {
                    console.error("Error loading data for", dateOfCell, ":", error);
                }
            });
        }


        document.addEventListener('DOMContentLoaded', function () {
            generateTableHeader();
            generateTableBody();
            document.querySelector('table').addEventListener('input', saveAgendaData);
        });
        document.addEventListener('DOMContentLoaded', function () {
            updateWeekLabel();
            generateTableHeader();
            generateTableBody();
            loadAgendaData();  // Asegúrate de cargar los datos al inicio.
            document.querySelector('table').addEventListener('input', saveAgendaData);
            const sidebar = document.getElementById('mySidebar');
            sidebar.addEventListener('mouseover', openNav);
            sidebar.addEventListener('mouseout', closeNav);
            randomizeColors();
        });

        // Function to add weeks automatically to Firestore
        async function addWeeksToFirestore(startYear) {
                const startDate = new Date(startYear, 0, 1); // Comienza en el 1 de enero del año dado
                const endDate = new Date(startYear + 1, 0, 1); // Hasta el 1 de enero del siguiente año
                let currentDate = new Date(startDate);

                while (currentDate < endDate) {
                    let dayDoc = {
                        date: currentDate.toISOString().slice(0, 10),
                        Morning: { activity: "" },
                        Noon: { activity: "" },
                        Afternoon: { activity: "" },
                        Evening: { activity: "" },
                        Night: { activity: "" } // Asumiendo que también hay una franja "Night"
                    };

                    // Incrementa la fecha en un día
                    let nextDate = new Date(currentDate);
                    nextDate.setDate(currentDate.getDate() + 1);

                    const dayRef = doc(db, "agenda", dayDoc.date); // Usa la fecha como identificador del documento
                    await setDoc(dayRef, dayDoc);
                    console.log(`Day ${dayDoc.date} added successfully`);

                    currentDate = nextDate;
                }
            }

        window.onload = function () {
            const addButton = document.getElementById('addDataButton');
            if (addButton) {
                addButton.onclick = function () {
                    addWeeksToFirestore(2024).then(() => console.log("Weeks added successfully"))
                        .catch(error => console.error("Error adding weeks: ", error));
                };
            } else {
                console.error("Add button not found");
            }
        };
        async function testWrite() {
            const db = getFirestore(initializeApp(firebaseConfig));
            try {
                await setDoc(doc(db, "testCollection", "testDoc"), { content: "Hello Firestore!" });
                console.log("Document written");
            } catch (error) {
                console.error("Error writing document: ", error);
            }
        }

        testWrite();

    </script>

    <button id="addDataButton">Add Weeks to Firestore</button>
</body>
</html>
